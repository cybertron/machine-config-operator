filesystem: "root"
mode: 0644
path: "/etc/kubernetes/static-pod-resources/coredns/Corefile.tmpl"
contents:
  inline: |
    . {
        errors
        health :18080
        forward . {{`{{- range $upstream := .DNSUpstreams}} {{$upstream}}{{- end}}`}}
        cache 30
        reload
{{ if eq .Infra.Status.PlatformStatus.BareMetal.UseMDNS "all" }}
        mdns {{ .EtcdDiscoveryDomain }} 0 {{`{{.Cluster.Name}}`}}
        hosts {
            {{ .Infra.Status.PlatformStatus.BareMetal.APIServerInternalIP }} api-int.{{ .EtcdDiscoveryDomain }}
            fallthrough
        }
{{ end }}
    }
